<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Wildberries ‚Äî –ü–æ–∫—É–ø–∞—Ç–µ–ª—å</title>
  <!-- 
    –§–∞–π–ª: client/index.html
    –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –°–∞–π—Ç –ø–æ–∫—É–ø–∞—Ç–µ–ª—è
    –ê–≤—Ç–æ—Ä: –°–∏—Å—Ç–µ–º–∞ Wildberries Clone
    –í–µ—Ä—Å–∏—è: 1.0
    –î–∞—Ç–∞: 2025-04-05
    –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
      - –í—Ö–æ–¥ –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞
      - –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç —Å –∑–∞–∫–∞–∑–∞–º–∏
      - –ü–æ—Å—Ç–æ—è–Ω–Ω—ã–π QR-–∫–æ–¥ –¥–ª—è –≤—ã–¥–∞—á–∏
      - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∑–∞–∫–∞–∑–∞
      - –ì–æ–ª–æ—Å–æ–≤–æ–µ –æ–ø–æ–≤–µ—â–µ–Ω–∏–µ
      - 1000+ —Ç–æ–≤–∞—Ä–æ–≤
      - –†–∞–±–æ—Ç–∞ —Å Firebase Realtime Database
  -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <style>
    /* 
      –°—Ç–∏–ª–∏ –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–æ–∫—É–ø–∞—Ç–µ–ª—è
      –§–æ–Ω: –≥—Ä–∞–¥–∏–µ–Ω—Ç —Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π
      –®—Ä–∏—Ñ—Ç—ã: Segoe UI
      –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è —Å–µ—Ç–∫–∞
    */
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
    body { background: linear-gradient(135deg, #f5f7fa 0%, #e4edf9 100%); color: #333; min-height: 100vh; }
    .screen { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: none; flex-direction: column; padding: 20px; overflow-y: auto; }
    #login-screen { display: flex; background: linear-gradient(135deg, #6c5ce7 0%, #a29bfe 100%); color: white; justify-content: center; align-items: center; flex-direction: column; text-align: center; }
    .logo { font-size: 32px; font-weight: bold; margin-bottom: 20px; text-shadow: 0 2px 4px rgba(0,0,0,0.2); }
    .logo span { color: #ff6b6b; }
    input, button { padding: 14px; margin: 10px 0; font-size: 16px; border-radius: 8px; border: 1px solid #ccc; width: 100%; max-width: 400px; }
    input { background: white; color: #333; }
    button { cursor: pointer; background: #6c5ce7; color: white; border: none; font-weight: bold; }
    button:hover { background: #5d4de0; transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.15); }
    .btn-success { background: #2ecc71; }
    .btn-success:hover { background: #27ae60; }
    .product-card { background: white; border-radius: 12px; padding: 16px; margin: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
    .product-name { font-size: 18px; font-weight: 600; margin-bottom: 8px; color: #2c3e50; }
    .product-price { font-size: 20px; font-weight: bold; color: #6c5ce7; margin: 8px 0; }
    .cart-item { display: flex; justify-content: space-between; padding: 14px; background: white; border-radius: 10px; margin: 10px 0; box-shadow: 0 2px 6px rgba(0,0,0,0.05); }
    .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #eee; }
    .header h2 { color: #6c5ce7; }
    .search-bar { width: 100%; max-width: 600px; padding: 14px 20px; font-size: 16px; border-radius: 50px; border: 2px solid #6c5ce7; outline: none; margin-bottom: 20px; }
    .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
    .notification { position: fixed; bottom: 20px; right: 20px; background: #6c5ce7; color: white; padding: 16px; border-radius: 10px; box-shadow: 0 6px 20px rgba(0,0,0,0.2); max-width: 350px; z-index: 1000; display: none; }
    .order-card { background: white; border-radius: 12px; padding: 18px; margin: 15px 0; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
    .qr-container { background: white; padding: 20px; border-radius: 12px; text-align: center; margin: 20px auto; max-width: 300px; box-shadow: 0 6px 16px rgba(0,0,0,0.15); }
    .qr-header { color: #6c5ce7; font-size: 24px; font-weight: bold; margin-bottom: 10px; }
    .qr-barcode { margin: 15px 0; font-family: monospace; font-size: 16px; }
    .qr-numbers { font-family: monospace; font-size: 18px; margin-top: 5px; }
    .item-image { width: 100px; height: 100px; object-fit: cover; margin: 10px 0; }
  </style>
</head>
<body>

<!-- –≠–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞ -->
<div id="login-screen" class="screen">
  <div class="logo">Wild<span>berries</span></div>
  <h2>–í—Ö–æ–¥ –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞</h2>
  <p>–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –Ω–æ–º–µ—Ä –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –ª–∏—á–Ω–æ–º—É –∫–∞–±–∏–Ω–µ—Ç—É</p>
  <input type="tel" id="phone-input" placeholder="79991234567" maxlength="11" autofocus />
  <button onclick="login()">–í–æ–π—Ç–∏</button>
</div>

<!-- –ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω -->
<div id="main-screen" class="screen">
  <div class="header">
    <h2>üõçÔ∏è –ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤</h2>
    <div>
      <button onclick="showCart()">–ö–æ—Ä–∑–∏–Ω–∞ (<span id="cart-count">0</span>)</button>
      <button onclick="showOrders()">–ú–æ–∏ –∑–∞–∫–∞–∑—ã</button>
      <button onclick="logout()">–í—ã—Ö–æ–¥</button>
    </div>
  </div>
  <input type="text" class="search-bar" id="search-input" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é —Ç–æ–≤–∞—Ä–∞..." oninput="searchProducts()" />
  <div class="grid" id="product-grid"></div>
</div>

<!-- –ö–æ—Ä–∑–∏–Ω–∞ -->
<div id="cart-screen" class="screen">
  <div class="header">
    <h2>üõí –ö–æ—Ä–∑–∏–Ω–∞</h2>
    <button onclick="backToMain()">‚Üê –ù–∞–∑–∞–¥</button>
  </div>
  <div id="cart-items"></div>
  <div style="margin-top: 20px; padding: 20px; background: white; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.08);">
    <h3>–°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã</h3>
    <label style="display: block; margin: 10px 0;">
      <input type="radio" name="payment-method" value="online" checked /> –û–Ω–ª–∞–π–Ω –æ–ø–ª–∞—Ç–∞
    </label>
    <label style="display: block; margin: 10px 0;">
      <input type="radio" name="payment-method" value="cash" /> –û–ø–ª–∞—Ç–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏
    </label>
    <div style="margin-top: 15px;">
      <strong>–ò—Ç–æ–≥–æ: <span id="cart-total">0</span> ‚ÇΩ</strong>
    </div>
    <button class="btn-success" style="width: 100%; margin-top: 15px;" onclick="placeOrder()">–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
  </div>
</div>

<!-- –ó–∞–∫–∞–∑—ã -->
<div id="orders-screen" class="screen">
  <div class="header">
    <h2>üì¶ –ú–æ–∏ –∑–∞–∫–∞–∑—ã</h2>
    <button onclick="backToMain()">‚Üê –ù–∞–∑–∞–¥</button>
  </div>
  <div id="orders-list"></div>
</div>

<!-- –î–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞ -->
<div id="order-detail-screen" class="screen">
  <div class="header">
    <h2>üìù –î–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞</h2>
    <button onclick="backToOrders()">‚Üê –ù–∞–∑–∞–¥</button>
  </div>
  <div id="order-info"></div>
  <div id="qr-container" class="qr-container" style="display:none;">
    <div class="qr-header">WB</div>
    <div id="qr-code"></div>
    <div class="qr-barcode" id="barcode-number"></div>
    <div class="qr-numbers" id="qr-numbers"></div>
  </div>
  <button class="btn-success" style="margin-top: 20px;" onclick="copyQR()">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å QR</button>
  <button class="btn-warning" style="margin-top: 10px;" onclick="printQR()">–ü–µ—á–∞—Ç—å QR</button>
</div>

<!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ -->
<div id="notification" class="notification">
  <strong>üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ</strong>
  <p id="notification-text">–í–∞—à –∑–∞–∫–∞–∑ –ø—Ä–∏–±—ã–ª –≤ –ü–í–ó!</p>
</div>

<script>
  // === –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase ===
  // –ò—Å–ø–æ–ª—å–∑—É–µ–º –≤–∞—à—É –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
  const firebaseConfig = {
    databaseURL: "https://renessans-bank-3df94-default-rtdb.europe-west1.firebasedatabase.app/"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // === –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ ===
  let currentUser = null;
  let cart = [];
  let allProducts = [];

  // === –ì–µ–Ω–µ—Ä–∞—Ü–∏—è 1000+ —Ç–æ–≤–∞—Ä–æ–≤ ===
  // –°–æ–∑–¥–∞—ë–º —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ –∏ —Ü–µ–Ω–∞–º–∏
  function generateProducts() {
    const categories = [
      "–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞", "–û–¥–µ–∂–¥–∞", "–û–±—É–≤—å", "–ö–æ—Å–º–µ—Ç–∏–∫–∞", "–ë—ã—Ç", "–ü—Ä–æ–¥—É–∫—Ç—ã", 
      "–ò–≥—Ä—É—à–∫–∏", "–ö–Ω–∏–≥–∏", "–°–ø–æ—Ä—Ç", "–ê–≤—Ç–æ", "–î–æ–º", "–°–∞–¥", "–ó–æ–æ—Ç–æ–≤–∞—Ä—ã"
    ];
    const adjectives = ["–ü—Ä–µ–º–∏—É–º", "–≠–∫–æ–Ω–æ–º", "–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π", "–î–µ—Ç—Å–∫–∏–π", "–õ–µ—Ç–Ω–∏–π", "–ó–∏–º–Ω–∏–π", "–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π"];
    const nouns = ["–Ω–∞–±–æ—Ä", "—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ", "–∫–æ–º–ø–ª–µ–∫—Ç", "—Å—Ä–µ–¥—Å—Ç–≤–æ", "–∞–∫—Å–µ—Å—Å—É–∞—Ä", "–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç", "–æ–¥–µ–∂–¥–∞"];

    for (let i = 1; i <= 1000; i++) {
      const category = categories[Math.floor(Math.random() * categories.length)];
      const adj = adjectives[Math.floor(Math.random() * adjectives.length)];
      const noun = nouns[Math.floor(Math.random() * nouns.length)];
      const name = `${adj} ${category.toLowerCase()} ${noun}`;
      const price = Math.floor(Math.random() * 8000) + 200; // –æ—Ç 200 –¥–æ 8200 —Ä—É–±
      allProducts.push({ id: i, name, price, category });
    }
  }

  // === –§—É–Ω–∫—Ü–∏—è –≤—Ö–æ–¥–∞ ===
  // –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ñ–æ—Ä–º–∞—Ç –Ω–æ–º–µ—Ä–∞ –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å–µ—Å—Å–∏—é
  function login() {
    const phone = document.getElementById("phone-input").value.replace(/\D/g, '');
    if (phone.length !== 11 || !phone.startsWith('7')) {
      alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –≤ —Ñ–æ—Ä–º–∞—Ç–µ 79991234567");
      return;
    }
    currentUser = phone;
    document.getElementById("login-screen").style.display = "none";
    document.getElementById("main-screen").style.display = "flex";
    renderProducts(allProducts.slice(0, 50));
    listenForOrderUpdates();
  }

  // === –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã ===
  function logout() {
    currentUser = null;
    cart = [];
    document.getElementById("main-screen").style.display = "none";
    document.getElementById("cart-screen").style.display = "none";
    document.getElementById("orders-screen").style.display = "none";
    document.getElementById("order-detail-screen").style.display = "none";
    document.getElementById("login-screen").style.display = "flex";
    document.getElementById("phone-input").value = "";
  }

  // === –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ ===
  function renderProducts(products) {
    const grid = document.getElementById("product-grid");
    grid.innerHTML = products.map(p => `
      <div class="product-card">
        <div class="product-name">${p.name}</div>
        <div class="product-price">${p.price} ‚ÇΩ</div>
        <button onclick="addToCart(${p.id})">–í –∫–æ—Ä–∑–∏–Ω—É</button>
      </div>
    `).join('');
  }

  // === –ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤ ===
  function searchProducts() {
    const query = document.getElementById("search-input").value.toLowerCase();
    if (query.trim() === "") {
      renderProducts(allProducts.slice(0, 50));
      return;
    }
    const filtered = allProducts.filter(p => 
      p.name.toLowerCase().includes(query) || 
      p.category.toLowerCase().includes(query)
    );
    renderProducts(filtered.slice(0, 50));
  }

  // === –†–∞–±–æ—Ç–∞ —Å –∫–æ—Ä–∑–∏–Ω–æ–π ===
  function addToCart(productId) {
    cart.push(productId);
    updateCartCount();
    showNotification("–¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É!");
  }

  function updateCartCount() {
    document.getElementById("cart-count").textContent = cart.length;
  }

  function showCart() {
    document.getElementById("main-screen").style.display = "none";
    document.getElementById("cart-screen").style.display = "flex";
    updateCartDisplay();
  }

  function updateCartDisplay() {
    const container = document.getElementById("cart-items");
    container.innerHTML = "";
    if (cart.length === 0) {
      container.innerHTML = "<p>–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</p>";
      document.getElementById("cart-total").textContent = "0";
      return;
    }

    let total = 0;
    const cartItems = cart.map(id => allProducts.find(p => p.id === id)).filter(Boolean);
    cartItems.forEach((item, index) => {
      total += item.price;
      const div = document.createElement("div");
      div.className = "cart-item";
      div.innerHTML = `
        <div>
          <strong>${item.name}</strong><br>
          ${item.price} ‚ÇΩ
        </div>
        <button class="btn-danger" onclick="removeFromCart(${index})">–£–¥–∞–ª–∏—Ç—å</button>
      `;
      container.appendChild(div);
    });
    document.getElementById("cart-total").textContent = total;
  }

  function removeFromCart(index) {
    cart.splice(index, 1);
    updateCartDisplay();
    updateCartCount();
  }

  function backToMain() {
    document.getElementById("cart-screen").style.display = "none";
    document.getElementById("orders-screen").style.display = "none";
    document.getElementById("order-detail-screen").style.display = "none";
    document.getElementById("main-screen").style.display = "flex";
  }

  // === –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞ ===
  function placeOrder() {
    if (cart.length === 0) {
      alert("–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞!");
      return;
    }

    const paymentMethod = document.querySelector('input[name="payment-method"]:checked').value;
    const items = cart.map(id => allProducts.find(p => p.id === id)).filter(Boolean);
    const total = items.reduce((sum, item) => sum + item.price, 0);

    const order = {
      userId: currentUser,
      items: items,
      total: total,
      paymentMethod: paymentMethod,
      status: "created",
      pvzAddress: "–ì. –ë–∞–ª–∞—à–∏—Ö–∞, –ø—Ä–æ—Å–ø–µ–∫—Ç –õ–µ–Ω–∏–Ω–∞, 32–î",
      timestamp: firebase.database.ServerValue.TIMESTAMP
    };

    db.ref('orders').push(order)
      .then(() => {
        cart = [];
        updateCartCount();
        showNotification("–ó–∞–∫–∞–∑ —É—Å–ø–µ—à–Ω–æ –æ—Ñ–æ—Ä–º–ª–µ–Ω! –û–∂–∏–¥–∞–π—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏.");
        backToMain();
      })
      .catch(err => {
        alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–∞: " + err.message);
      });
  }

  // === –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–∫–∞–∑–æ–≤ ===
  function showOrders() {
    document.getElementById("main-screen").style.display = "none";
    document.getElementById("orders-screen").style.display = "flex";
    loadUserOrders();
  }

  function loadUserOrders() {
    const list = document.getElementById("orders-list");
    list.innerHTML = "<p>–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–∫–∞–∑–æ–≤...</p>";

    db.ref('orders')
      .orderByChild('userId')
      .equalTo(currentUser)
      .once('value')
      .then(snapshot => {
        list.innerHTML = "";
        if (!snapshot.exists()) {
          list.innerHTML = "<p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–∫–∞–∑–æ–≤.</p>";
          return;
        }

        snapshot.forEach(child => {
          const order = child.val();
          const statusText = {
            "created": "–û–∂–∏–¥–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏",
            "received": "–ì–æ—Ç–æ–≤ –∫ –≤—ã–¥–∞—á–µ",
            "issued": "–í—ã–¥–∞–Ω",
            "defect": "–ë—Ä–∞–∫"
          }[order.status] || order.status;

          const div = document.createElement("div");
          div.className = "order-card";
          div.innerHTML = `
            <h3>–ó–∞–∫–∞–∑ ‚Ññ${child.key.slice(-6)}</h3>
            <p><strong>–°—Ç–∞—Ç—É—Å:</strong> ${statusText}</p>
            <p><strong>–°—É–º–º–∞:</strong> ${order.total} ‚ÇΩ</p>
            <p><strong>–û–ø–ª–∞—Ç–∞:</strong> ${order.paymentMethod === 'cash' ? '–ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏' : '–û–Ω–ª–∞–π–Ω'}</p>
            <p><strong>–ü–í–ó:</strong> ${order.pvzAddress}</p>
            <p><strong>–¢–æ–≤–∞—Ä–æ–≤:</strong> ${order.items.length}</p>
            <button onclick="showOrderDetail('${child.key}')">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</button>
          `;
          list.appendChild(div);
        });
      });
  }

  // === –î–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞ ===
  function showOrderDetail(orderId) {
    db.ref('orders/' + orderId).once('value').then(snapshot => {
      const order = snapshot.val();
      if (!order) return;

      document.getElementById("orders-screen").style.display = "none";
      document.getElementById("order-detail-screen").style.display = "flex";

      const info = document.getElementById("order-info");
      info.innerHTML = `
        <h3>–ó–∞–∫–∞–∑ ‚Ññ${orderId.slice(-6)}</h3>
        <p><strong>–°—Ç–∞—Ç—É—Å:</strong> ${order.status}</p>
        <p><strong>–°—É–º–º–∞:</strong> ${order.total} ‚ÇΩ</p>
        <p><strong>–û–ø–ª–∞—Ç–∞:</strong> ${order.paymentMethod === 'cash' ? '–ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏' : '–û–Ω–ª–∞–π–Ω'}</p>
        <p><strong>–ü–í–ó:</strong> ${order.pvzAddress}</p>
        <h4>–¢–æ–≤–∞—Ä—ã:</h4>
        <ul>${order.items.map(item => `<li>${item.name} ‚Äî ${item.price} ‚ÇΩ</li>`).join('')}</ul>
      `;

      // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è QR-–∫–æ–¥–∞ –¥–ª—è –≤—ã–¥–∞—á–∏
      const qrData = JSON.stringify({
        orderId: orderId,
        userId: order.userId,
        pvz: "PVZ_BALASHIHA_32D",
        timestamp: Date.now()
      });

      document.getElementById("qr-code").innerHTML = "";
      new QRCode(document.getElementById("qr-code"), {
        text: qrData,
        width: 180,
        height: 180
      });

      // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —à—Ç—Ä–∏—Ö–∫–æ–¥–∞ (EAN-13 –∏–º–∏—Ç–∞—Ü–∏—è)
      const now = Date.now().toString().slice(-9);
      const nameHash = order.items[0].name.split('').reduce((a, b) => ((a << 5) - a + b.charCodeAt(0)) | 0, 0).toString().replace('-', '').slice(0,3);
      let code12 = (now + nameHash).padEnd(12, '0').slice(0,12);
      let sum = 0;
      for (let i = 0; i < 12; i++) {
        sum += parseInt(code12[i]) * (i % 2 === 0 ? 1 : 3);
      }
      const check = (10 - (sum % 10)) % 10;
      const barcode = code12 + check;
      document.getElementById("barcode-number").textContent = barcode;
      document.getElementById("qr-numbers").textContent = barcode;
      document.getElementById("qr-container").style.display = "block";
    });
  }

  function backToOrders() {
    document.getElementById("order-detail-screen").style.display = "none";
    document.getElementById("orders-screen").style.display = "flex";
  }

  // === –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è ===
  function showNotification(text) {
    const notif = document.getElementById("notification");
    document.getElementById("notification-text").textContent = text;
    notif.style.display = "block";
    setTimeout(() => {
      notif.style.display = "none";
    }, 5000);
  }

  // === –°–ª—É—à–∞—Ç–µ–ª—å –∏–∑–º–µ–Ω–µ–Ω–∏–π –∑–∞–∫–∞–∑–æ–≤ ===
  function listenForOrderUpdates() {
    if (!currentUser) return;

    db.ref('orders')
      .orderByChild('userId')
      .equalTo(currentUser)
      .on('child_changed', (snapshot) => {
        const order = snapshot.val();
        if (order.status === 'received') {
          const msg = `–í–∞—à –∑–∞–∫–∞–∑ ‚Ññ${snapshot.key.slice(-6)} –≥–æ—Ç–æ–≤ –∫ –≤—ã–¥–∞—á–µ –≤ –ü–í–ó: –ì. –ë–∞–ª–∞—à–∏—Ö–∞, –ø—Ä–æ—Å–ø–µ–∫—Ç –õ–µ–Ω–∏–Ω–∞, 32–î.`;
          showNotification(msg);
          if ('speechSynthesis' in window) {
            const utterance = new SpeechSynthesisUtterance(msg);
            utterance.lang = 'ru-RU';
            speechSynthesis.speak(utterance);
          }
        }
      });
  }

  // === –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø–µ—á–∞—Ç—å QR ===
  function copyQR() {
    const canvas = document.querySelector('#qr-code canvas');
    if (canvas) {
      canvas.toBlob(blob => {
        navigator.clipboard.write([
          new ClipboardItem({ 'image/png': blob })
        ]).then(() => {
          showNotification("QR-–∫–æ–¥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!");
        });
      });
    }
  }

  function printQR() {
    window.print();
  }

  // === –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ===
  generateProducts();
  document.getElementById("login-screen").style.display = "flex";

  // –ó–∞–ø—É—Å–∫ —Å–ª—É—à–∞—Ç–µ–ª—è –ø–æ—Å–ª–µ –≤—Ö–æ–¥–∞
  const originalLogin = login;
  login = function() {
    originalLogin();
    setTimeout(listenForOrderUpdates, 1000);
  };
</script>

</body>
</html>
